<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RUI-DHANORE ZONE FPC Shareholder Management</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* Reset and base */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #2f4f2f;
    }
    
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      width: 500px;
      max-width: 95vw;
      padding: 35px 40px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #a8e063, #56ab2f, #2c6e2c);
    }
    
    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      color: #2c6e2c;
      text-align: center;
      margin: 0;
      letter-spacing: 1px;
      text-transform: uppercase;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
      padding-bottom: 12px;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 25%;
      width: 50%;
      height: 3px;
      background: linear-gradient(90deg, transparent, #a8e063, transparent);
      border-radius: 3px;
    }
    
    form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      position: relative;
    }
    
    label {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #2c6e2c;
      user-select: none;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
    }
    
    label::before {
      content: '•';
      color: #56ab2f;
      margin-right: 6px;
      font-size: 1.2rem;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="date"],
    input[type="password"] {
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid #c5e1c5;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-weight: 500;
      color: #2f4f2f;
      background-color: #f9fff9;
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: #2c6e2c;
      box-shadow: 0 0 0 3px rgba(44, 110, 44, 0.2);
      background: #f0fff0;
      transform: translateY(-2px);
    }
    
    input[readonly] {
      background-color: #e9f6e9;
      border-color: #a1d99a;
      color: #3a5f3a;
      font-weight: 700;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }
    
    button {
      flex: 1;
      padding: 16px 0;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      letter-spacing: 0.03em;
      transition: all 0.3s ease;
      color: white;
      user-select: none;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 5px;
      height: 5px;
      background: rgba(255, 255, 255, 0.5);
      opacity: 0;
      border-radius: 100%;
      transform: scale(1, 1) translate(-50%);
      transform-origin: 50% 50%;
    }
    
    button:focus:not(:active)::after {
      animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
      0% {
        transform: scale(0, 0);
        opacity: 0.5;
      }
      100% {
        transform: scale(20, 20);
        opacity: 0;
      }
    }
    
    button[type="submit"] {
      background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
    }
    
    button[type="submit"]:hover {
      background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
      box-shadow: 0 8px 20px rgba(46, 125, 50, 0.4);
      transform: translateY(-3px);
    }
    
    button[type="reset"] {
      background: linear-gradient(135deg, #a5d6a7 0%, #8bc34a 100%);
      color: #2c6e2c;
    }
    
    button[type="reset"]:hover {
      background: linear-gradient(135deg, #8bc34a 0%, #7cb342 100%);
      color: white;
      box-shadow: 0 8px 20px rgba(139, 195, 74, 0.4);
      transform: translateY(-3px);
    }
    
    .export-btn {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
      margin-top: 10px;
      width: 100%;
    }
    
    .export-btn:hover {
      background: linear-gradient(135deg, #f57c00 0%, #e65100 100%);
      box-shadow: 0 8px 20px rgba(245, 124, 0, 0.4);
      transform: translateY(-3px);
    }
    
    .danger-btn {
      background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
      margin-top: 10px;
      width: 100%;
    }
    
    .danger-btn:hover {
      background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
      box-shadow: 0 8px 20px rgba(211, 47, 47, 0.4);
      transform: translateY(-3px);
    }
    
    .secondary-btn {
      background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
      margin-top: 10px;
      width: 100%;
    }
    
    .secondary-btn:hover {
      background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
      box-shadow: 0 8px 20px rgba(25, 118, 210, 0.4);
      transform: translateY(-3px);
    }
    
    .message {
      text-align: center;
      font-weight: 700;
      font-size: 1.1rem;
      color: #2e7d32;
      user-select: none;
      min-height: 1.5em;
      padding: 12px;
      letter-spacing: 0.03em;
      text-shadow: 0 1px 1px rgba(0,0,0,0.1);
      background-color: #e8f5e9;
      border-radius: 10px;
      border-left: 4px solid #4caf50;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(10px);
    }
    
    .message.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    .message.error {
      color: #c62828;
      background-color: #ffebee;
      border-left: 4px solid #f44336;
    }
    
    .message.warning {
      color: #ff8f00;
      background-color: #fff8e1;
      border-left: 4px solid #ffc107;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
    }
    
    .form-row .form-group {
      flex: 1;
    }
    
    .management-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px dashed #c5e1c5;
    }
    
    .management-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .login-container {
      display: none;
    }
    
    .app-container {
      display: none;
    }
    
    .active {
      display: flex;
    }
    
    /* Responsive */
    @media (max-width: 520px) {
      .container {
        padding: 25px 20px;
        width: 100%;
      }
      
      .form-row {
        flex-direction: column;
        gap: 20px;
      }
      
      button {
        font-size: 1rem;
        padding: 14px 0;
      }
      
      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="container login-container active" id="loginContainer">
    <div style="width: 100%;">
      <h1>RUI-DHANORE ZONE FPC</h1>
      <h2 style="text-align: center; margin-bottom: 20px; color: #2c6e2c;">Admin Login</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="username" required />
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" required />
        </div>
        
        <button type="submit" style="width: 100%; margin-top: 20px;">Login</button>
      </form>
      <div class="message" id="loginMessage" role="alert" aria-live="polite"></div>
    </div>
  </div>

  <!-- Main Application -->
  <div class="container app-container" id="appContainer">
    <h1>RUI-DHANORE ZONE FPC Shareholder Management</h1>
    <form id="shareholderForm" novalidate>
      <div class="form-group">
        <label for="srNo">Sr.No</label>
        <input type="number" id="srNo" name="srNo" readonly aria-readonly="true" />
      </div>
      
      <div class="form-group">
        <label for="shareholderName">Shareholder Name</label>
        <input type="text" id="shareholderName" name="shareholderName" required autocomplete="name" />
      </div>
      
      <div class="form-group">
        <label for="mobileNo">Mobile No</label>
        <input type="text" id="mobileNo" name="mobileNo" pattern="^\d{10}$" maxlength="10" required autocomplete="tel" inputmode="numeric" />
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="village">Village</label>
          <input type="text" id="village" name="village" required autocomplete="address-level2" />
        </div>
        
        <div class="form-group">
          <label for="taluka">Taluka</label>
          <input type="text" id="taluka" name="taluka" required />
        </div>
      </div>
      
      <div class="form-group">
        <label for="district">District</label>
        <input type="text" id="district" name="district" required autocomplete="address-level1" />
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="aadhaarNo">Aadhaar No</label>
          <input type="text" id="aadhaarNo" name="aadhaarNo" pattern="^\d{12}$" maxlength="12" required inputmode="numeric" />
        </div>
        
        <div class="form-group">
          <label for="panNo">PAN No</label>
          <input type="text" id="panNo" name="panNo" pattern="^[A-Za-z]{5}\d{4}[A-Za-z]{1}$" maxlength="10" required style="text-transform:uppercase" />
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="shareCertNo">Share Certificate No</label>
          <input type="text" id="shareCertNo" name="shareCertNo" required />
        </div>
        
        <div class="form-group">
          <label for="noOfShares">No. of Shares</label>
          <input type="number" id="noOfShares" name="noOfShares" min="1" required />
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="shareValue">Share Value (₹)</label>
          <input type="number" id="shareValue" name="shareValue" min="0.01" step="0.01" required value="10000" />
        </div>
        
        <div class="form-group">
          <label for="totalInvestment">Total Investment (₹)</label>
          <input type="number" id="totalInvestment" name="totalInvestment" readonly aria-readonly="true" />
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="dateAllotment">Date of Allotment</label>
          <input type="date" id="dateAllotment" name="dateAllotment" required />
        </div>
        
        <div class="form-group">
          <label for="transferDate">Transfer Date (optional)</label>
          <input type="date" id="transferDate" name="transferDate" />
        </div>
      </div>
      
      <div class="button-group">
        <button type="submit" id="submitBtn" aria-label="Submit shareholder details">Submit</button>
        <button type="reset" id="resetBtn" aria-label="Reset the form">Reset</button>
      </div>
      
      <button type="button" id="updateBtn" class="secondary-btn" aria-label="Update shareholder details" style="display: none;">Update Record</button>
      <button type="button" id="exportBtn" class="export-btn" aria-label="Export data to Excel">Export to Excel</button>
    </form>
    
    <div class="management-section">
      <h2 style="font-size: 1.4rem; color: #2c6e2c; margin-bottom: 15px; text-align: center;">Data Management</h2>
      <div class="form-row">
        <div class="form-group">
          <label for="searchId">Search by Sr.No</label>
          <input type="number" id="searchId" name="searchId" min="1" />
        </div>
        <div class="form-group" style="justify-content: flex-end;">
          <button type="button" id="searchBtn" class="secondary-btn" style="margin-top: 24px;">Search</button>
        </div>
      </div>
      
      <div class="management-buttons">
        <button type="button" id="deleteBtn" class="danger-btn">Delete Record</button>
        <button type="button" id="clearAllBtn" class="danger-btn">Clear All Data</button>
        <button type="button" id="logoutBtn" class="secondary-btn">Logout</button>
      </div>
    </div>
    
    <div class="message" id="confirmationMessage" role="alert" aria-live="polite"></div>
  </div>

  <script>
    (function() {
      // DOM Elements
      const loginContainer = document.getElementById('loginContainer');
      const appContainer = document.getElementById('appContainer');
      const loginForm = document.getElementById('loginForm');
      const loginMessage = document.getElementById('loginMessage');
      const form = document.getElementById('shareholderForm');
      const srNoInput = document.getElementById('srNo');
      const noOfSharesInput = document.getElementById('noOfShares');
      const shareValueInput = document.getElementById('shareValue');
      const totalInvestmentInput = document.getElementById('totalInvestment');
      const confirmationMessage = document.getElementById('confirmationMessage');
      const resetBtn = document.getElementById('resetBtn');
      const exportBtn = document.getElementById('exportBtn');
      const updateBtn = document.getElementById('updateBtn');
      const submitBtn = document.getElementById('submitBtn');
      const searchBtn = document.getElementById('searchBtn');
      const searchIdInput = document.getElementById('searchId');
      const deleteBtn = document.getElementById('deleteBtn');
      const clearAllBtn = document.getElementById('clearAllBtn');
      const logoutBtn = document.getElementById('logoutBtn');

      // Application State
      let currentSrNo = parseInt(localStorage.getItem('currentSrNo')) || 1;
      let isEditing = false;
      let currentEditId = null;

      // Login credentials (in a real app, this would be server-side)
      const validCredentials = {
        username: "admin",
        password: "1234"
      };

      // Initialize the form
      function initializeForm() {
        srNoInput.value = currentSrNo;
        calculateTotalInvestment();
      }

      // Calculate total investment on input change
      function calculateTotalInvestment() {
        const shares = parseFloat(noOfSharesInput.value);
        const value = parseFloat(shareValueInput.value);
        if (!isNaN(shares) && !isNaN(value)) {
          totalInvestmentInput.value = (shares * value).toFixed(2);
        } else {
          totalInvestmentInput.value = '';
        }
      }

      // Show message with type (success, error, warning)
      function showMessage(message, type = 'success') {
        confirmationMessage.textContent = message;
        confirmationMessage.className = 'message show';
        
        if (type === 'error') {
          confirmationMessage.classList.add('error');
        } else if (type === 'warning') {
          confirmationMessage.classList.add('warning');
        }
        
        setTimeout(() => {
          confirmationMessage.classList.remove('show');
        }, 5000);
      }

      // Login functionality
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (username === validCredentials.username && password === validCredentials.password) {
          loginContainer.classList.remove('active');
          appContainer.classList.add('active');
          initializeForm();
        } else {
          loginMessage.textContent = 'Invalid username or password!';
          loginMessage.className = 'message show error';
        }
      });

      // Logout functionality
      logoutBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          appContainer.classList.remove('active');
          loginContainer.classList.add('active');
          loginForm.reset();
          loginMessage.textContent = '';
          loginMessage.className = 'message';
        }
      });

      // Form validation for patterns
      function validateField(field) {
        if(field.validity.patternMismatch) {
          if(field.name === 'mobileNo') {
            field.setCustomValidity('Mobile number must be exactly 10 digits.');
          } else if(field.name === 'aadhaarNo') {
            field.setCustomValidity('Aadhaar number must be exactly 12 digits.');
          } else if(field.name === 'panNo') {
            field.setCustomValidity('PAN number must be 10 characters in format: 5 letters, 4 digits, 1 letter.');
          } else {
            field.setCustomValidity('Invalid format.');
          }
        } else {
          field.setCustomValidity('');
        }
      }

      // Event listeners for form inputs
      noOfSharesInput.addEventListener('input', calculateTotalInvestment);
      shareValueInput.addEventListener('input', calculateTotalInvestment);

      form.addEventListener('input', e => {
        if(['mobileNo', 'aadhaarNo', 'panNo'].includes(e.target.name)) {
          validateField(e.target);
        }
      });

      // Form submission
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        confirmationMessage.textContent = '';
        confirmationMessage.className = 'message';

        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const formData = {
          srNo: srNoInput.value,
          shareholderName: form.shareholderName.value.trim(),
          mobileNo: form.mobileNo.value.trim(),
          village: form.village.value.trim(),
          taluka: form.taluka.value.trim(),
          district: form.district.value.trim(),
          aadhaarNo: form.aadhaarNo.value.trim(),
          panNo: form.panNo.value.trim().toUpperCase(),
          shareCertNo: form.shareCertNo.value.trim(),
          noOfShares: form.noOfShares.value.trim(),
          shareValue: form.shareValue.value.trim(),
          totalInvestment: totalInvestmentInput.value,
          dateAllotment: form.dateAllotment.value,
          transferDate: form.transferDate.value || ''
        };

        // Save data to localStorage
        let savedEntries = JSON.parse(localStorage.getItem('shareholderEntries') || '[]');
        
        if (isEditing) {
          // Update existing record
          const index = savedEntries.findIndex(entry => entry.srNo == currentEditId);
          if (index !== -1) {
            savedEntries[index] = formData;
            localStorage.setItem('shareholderEntries', JSON.stringify(savedEntries));
            showMessage(`Record with Sr.No ${currentEditId} updated successfully!`);
          }
          
          // Reset to add mode
          resetToAddMode();
        } else {
          // Add new record
          savedEntries.push(formData);
          localStorage.setItem('shareholderEntries', JSON.stringify(savedEntries));

          // Increment Sr.No
          currentSrNo++;
          localStorage.setItem('currentSrNo', currentSrNo);
          srNoInput.value = currentSrNo;

          showMessage('Data saved successfully!');
        }

        form.reset();
        totalInvestmentInput.value = '';
        if (!isEditing) {
          srNoInput.value = currentSrNo;
        }
      });

      // Reset form
      resetBtn.addEventListener('click', () => {
        confirmationMessage.textContent = '';
        confirmationMessage.className = 'message';
        totalInvestmentInput.value = '';
        
        if (isEditing) {
          resetToAddMode();
        } else {
          srNoInput.value = currentSrNo;
        }
      });

      // Search functionality
      searchBtn.addEventListener('click', function() {
        const searchId = searchIdInput.value;
        if (!searchId) {
          showMessage('Please enter a Sr.No to search!', 'warning');
          return;
        }

        const savedEntries = JSON.parse(localStorage.getItem('shareholderEntries') || '[]');
        const record = savedEntries.find(entry => entry.srNo == searchId);
        
        if (record) {
          // Populate form with record data
          srNoInput.value = record.srNo;
          form.shareholderName.value = record.shareholderName;
          form.mobileNo.value = record.mobileNo;
          form.village.value = record.village;
          form.taluka.value = record.taluka;
          form.district.value = record.district;
          form.aadhaarNo.value = record.aadhaarNo;
          form.panNo.value = record.panNo;
          form.shareCertNo.value = record.shareCertNo;
          form.noOfShares.value = record.noOfShares;
          form.shareValue.value = record.shareValue;
          totalInvestmentInput.value = record.totalInvestment;
          form.dateAllotment.value = record.dateAllotment;
          form.transferDate.value = record.transferDate || '';
          
          // Switch to edit mode
          isEditing = true;
          currentEditId = searchId;
          submitBtn.style.display = 'none';
          updateBtn.style.display = 'block';
          srNoInput.readOnly = true;
          
          showMessage(`Record with Sr.No ${searchId} loaded for editing.`, 'success');
        } else {
          showMessage(`No record found with Sr.No ${searchId}!`, 'error');
        }
      });

      // Update record
      updateBtn.addEventListener('click', function() {
        form.dispatchEvent(new Event('submit'));
      });

      // Delete record
      deleteBtn.addEventListener('click', function() {
        const searchId = searchIdInput.value;
        if (!searchId) {
          showMessage('Please enter a Sr.No to delete!', 'warning');
          return;
        }

        if (confirm(`Are you sure you want to delete record with Sr.No ${searchId}?`)) {
          const savedEntries = JSON.parse(localStorage.getItem('shareholderEntries') || '[]');
          const filteredEntries = savedEntries.filter(entry => entry.srNo != searchId);
          
          if (filteredEntries.length < savedEntries.length) {
            localStorage.setItem('shareholderEntries', JSON.stringify(filteredEntries));
            showMessage(`Record with Sr.No ${searchId} deleted successfully!`, 'success');
            searchIdInput.value = '';
            
            if (isEditing && currentEditId == searchId) {
              resetToAddMode();
            }
          } else {
            showMessage(`No record found with Sr.No ${searchId}!`, 'error');
          }
        }
      });

      // Clear all data
      clearAllBtn.addEventListener('click', function() {
        if (confirm('Are you sure you want to delete ALL data? This action cannot be undone!')) {
          localStorage.removeItem('shareholderEntries');
          localStorage.setItem('currentSrNo', '1');
          currentSrNo = 1;
          srNoInput.value = currentSrNo;
          showMessage('All data has been cleared successfully!', 'success');
          resetToAddMode();
        }
      });

      // Reset to add mode
      function resetToAddMode() {
        isEditing = false;
        currentEditId = null;
        submitBtn.style.display = 'block';
        updateBtn.style.display = 'none';
        srNoInput.readOnly = false;
        srNoInput.value = currentSrNo;
        searchIdInput.value = '';
      }

      // Export to Excel functionality
      exportBtn.addEventListener('click', function() {
        const savedEntries = JSON.parse(localStorage.getItem('shareholderEntries') || '[]');
        
        if (savedEntries.length === 0) {
          showMessage('No data available to export!', 'warning');
          return;
        }

        // Prepare data for Excel
        const headers = [
          "Sr.No", 
          "Shareholder Name", 
          "Mobile No", 
          "Village", 
          "Taluka", 
          "District", 
          "Aadhaar No", 
          "PAN No", 
          "Share Certificate No", 
          "No. of Shares", 
          "Share Value (₹)", 
          "Total Investment (₹)", 
          "Date of Allotment", 
          "Transfer Date"
        ];
        
        const data = [headers];
        
        // Add each entry to the data array
        savedEntries.forEach(entry => {
          data.push([
            entry.srNo,
            entry.shareholderName,
            entry.mobileNo,
            entry.village,
            entry.taluka,
            entry.district,
            entry.aadhaarNo,
            entry.panNo,
            entry.shareCertNo,
            entry.noOfShares,
            entry.shareValue,
            entry.totalInvestment,
            entry.dateAllotment,
            entry.transferDate
          ]);
        });

        // Create worksheet and workbook
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Shareholders");
        
        // Generate Excel file and trigger download
        XLSX.writeFile(wb, "RUI-DHANORE-ZONE-FPC.xlsx");
        
        showMessage('Excel file exported successfully!');
      });
    })();
  </script>
</body>
</html>